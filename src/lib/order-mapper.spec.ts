import { OrderMessage } from "../types";
import { mapOrderFeed } from "./order-mapper";

const createMessage = (): OrderMessage => {
  return {
    numLevels: 25,
    feed: "book_ui_1_snapshot",
    bids: [
      [61907.0, 4115.0],
      [61904.5, 8638.0],
      [61900.0, 4346.0],
      [61897.0, 4533.0],
      [61896.0, 14810.0],
      [61895.5, 23999.0],
      [61894.5, 2800.0],
      [61889.0, 22142.0],
      [61888.5, 7134.0],
      [61886.5, 25069.0],
      [61883.5, 1000.0],
      [61881.5, 10000.0],
      [61880.5, 5000.0],
      [61876.0, 7305.0],
      [61875.0, 25000.0],
      [61866.5, 25000.0],
      [61862.5, 15000.0],
      [61861.0, 76866.0],
      [61853.5, 4076.0],
      [61852.5, 2011.0],
      [61852.0, 5248.0],
      [61849.0, 12371.0],
      [61848.5, 87676.0],
      [61848.0, 7500.0],
      [61839.5, 399999.0],
    ],
    asks: [
      [61913.5, 604.0],
      [61920.5, 1000.0],
      [61924.5, 5528.0],
      [61933.5, 3000.0],
      [61934.0, 7582.0],
      [61934.5, 500.0],
      [61935.5, 21907.0],
      [61936.0, 7329.0],
      [61937.0, 50000.0],
      [61938.5, 2500.0],
      [61941.0, 2826.0],
      [61942.0, 12500.0],
      [61944.5, 21585.0],
      [61945.0, 7148.0],
      [61946.5, 4497.0],
      [61947.5, 61523.0],
      [61948.0, 15000.0],
      [61948.5, 6060.0],
      [61950.0, 40000.0],
      [61952.5, 25000.0],
      [61956.0, 500.0],
      [61956.5, 500.0],
      [61960.5, 129903.0],
      [61962.0, 15000.0],
      [61963.5, 20000.0],
    ],
    product_id: "PI_XBTUSD",
  };
};

describe("mapOrderFeed", () => {
  describe("maxTotals", () => {
    it("calculates the totals", () => {
      const result = mapOrderFeed(createMessage());
      expect(result.maxTotals.ask).toBe(461992);
      expect(result.maxTotals.bid).toBe(801638);
    });
  });
});
